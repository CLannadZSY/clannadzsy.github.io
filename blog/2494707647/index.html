<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=google-site-verification content="M1Cw9Od63LZv4K4V_iX8zomHSDnAy0-cWtfnSSas5YY"><meta name=referrer content="no-referrer-when-downgrade"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7158791715796373" crossorigin=anonymous></script><link rel=preload as=font href=https://clannad.icu/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://clannad.icu/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://clannad.icu/main.c97764f42f117e08318f3afdd866c1ed573797f31af2cba1c0e6038d8cc7d992c30ea22fa11fe737e7b7dedc3f485c17d76996d238e3fdd9dbc894698717df31.css integrity="sha512-yXdk9C8Rfggxjzr92GbB7Vc3l/Ma8suhwOYDjYzH2ZLDDqIvoR/nN+e33tw/SFwX12mW0jjj/dnbyJRphxffMQ==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>[Python] 卖家精灵 Chrome 插件 Js 逆向 - CL</title><meta name=description content="CLを書いて、人生を読みます。"><link rel=canonical href=https://clannad.icu/blog/2494707647/><meta name=twitter:card content="summary"><meta name=twitter:title content="[Python] 卖家精灵 Chrome 插件 Js 逆向"><meta name=twitter:description content="chrome://version, 查看 个人资料路径  C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default   打开插件所在文件夹: Extensions, 目录如下:
C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions    chrome://extensions/ 查看卖家精灵插件 ID
ID：lnbmbgocenenhhhdojdielgnmeflbnfb    根据插件ID, 寻找对应的文件夹并使用编辑器打开
  卖家精灵产品查询分析流程
  URL分析
  tk 参数分析
  B00DQFGJR4 不变, 更改 tk 的值, 提示无法使用此功能, 因此, tk 参数并不是随机生成的, 而是与 asin 有关
  使用编辑器, 全局搜索 tk , 发现 tk 参数, 都是由 N.a.s2Tkk(t) 方法生成
static asins(e, t) { return ve(this, void 0, void 0, (function*() { const a = yield n."><meta name=twitter:site content="@"><meta name=twitter:creator content="@"><meta property="og:title" content="[Python] 卖家精灵 Chrome 插件 Js 逆向"><meta property="og:description" content="chrome://version, 查看 个人资料路径  C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default   打开插件所在文件夹: Extensions, 目录如下:
C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions    chrome://extensions/ 查看卖家精灵插件 ID
ID：lnbmbgocenenhhhdojdielgnmeflbnfb    根据插件ID, 寻找对应的文件夹并使用编辑器打开
  卖家精灵产品查询分析流程
  URL分析
  tk 参数分析
  B00DQFGJR4 不变, 更改 tk 的值, 提示无法使用此功能, 因此, tk 参数并不是随机生成的, 而是与 asin 有关
  使用编辑器, 全局搜索 tk , 发现 tk 参数, 都是由 N.a.s2Tkk(t) 方法生成
static asins(e, t) { return ve(this, void 0, void 0, (function*() { const a = yield n."><meta property="og:type" content="article"><meta property="og:url" content="/blog/2494707647/"><meta property="article:published_time" content="2022-03-25T02:05:38+00:00"><meta property="article:modified_time" content="2022-03-25T02:05:38+00:00"><meta property="og:site_name" content="CL"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"\/blog\/2494707647\/"},"headline":"[Python] 卖家精灵 Chrome 插件 Js 逆向","image":[],"datePublished":"2022-03-25T02:05:38CET","dateModified":"2022-03-25T02:05:38CET","author":{"@type":"Organization","name":"CL"},"publisher":{"@type":"Organization","name":"CL","logo":{"@type":"ImageObject","url":"\/logo-doks.png"}},"description":""}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/clannad.icu\/"},{"@type":"ListItem","position":3,"name":"Blog","item":"https:\/\/clannad.icu\/\/blog\/"},{"@type":"ListItem","position":4,"name":"2494707647th","item":"https:\/\/clannad.icu\/\/blog\/2494707647\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://clannad.icu/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://clannad.icu/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://clannad.icu/favicon-16x16.png><link rel=manifest href=https://clannad.icu/site.webmanifest></head><body class="blog single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://clannad.icu/>CL</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/CLannadZSY><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class="nav-item active"><a class=nav-link href=https://clannad.icu/blog/>Blog</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div align=center><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7158791715796373 data-ad-slot=4686887066 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><div class="row justify-content-center"><div class="col-md-12 col-lg-10 col-xl-8"><article><div class=blog-header><h1>[Python] 卖家精灵 Chrome 插件 Js 逆向</h1><p><small>Posted March 25, 2022 by
<a class="stretched-link position-relative" href=https://clannad.icu/contributors/clannadzsy/>clannadzsy</a>
&nbsp;&dash;&nbsp;
<strong>5&nbsp;min read</strong></small><p></div><p class=lead></p><ol><li>chrome://version, 查看 <code>个人资料路径</code></li></ol><pre><code class=language-bash>C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default
</code></pre><ol start=2><li><p>打开插件所在文件夹: <code>Extensions</code>, 目录如下:</p><pre><code class=language-bash>C:\Users\用户名\AppData\Local\Google\Chrome\User Data\Default\Extensions
</code></pre></li><li><p><code>chrome://extensions/</code> 查看卖家精灵插件 ID</p><pre><code class=language-bash>ID：lnbmbgocenenhhhdojdielgnmeflbnfb
</code></pre></li><li><p>根据插件ID, 寻找对应的文件夹并使用编辑器打开</p></li><li><p>卖家精灵产品查询分析流程</p><ol><li><p>URL分析</p><p><img src=image-20220325102753803.png alt=image-20220325102753803></p></li><li><p><code>tk</code> 参数分析</p><ol><li><p>B00DQFGJR4 不变, 更改 tk 的值, 提示无法使用此功能, 因此, tk 参数并不是随机生成的, 而是与 asin 有关</p><p><img src=image-20220325103055076.png alt=image-20220325103055076></p></li><li><p>使用编辑器, 全局搜索 <code>tk</code> , 发现 tk 参数, 都是由 <code>N.a.s2Tkk(t)</code> 方法生成</p><pre><code class=language-js>      static asins(e, t) {
                return ve(this, void 0, void 0, (function*() {
              const a =
                        yield n.a.get(`${this.ASINS_URL}/${e.code}`, {
                            params: {
                                asins: t,
                                tk: N.a.s2Tkk(t)
                            }
                        });
                    return new Promise(e =&gt; e(this.parseList(a)))
                }))
            }
</code></pre><p>调用 s2Tkk(t), 其中 t 参数和 asins: t, 为同一个, 因此得知, t: 为我们需要查询的 asin</p></li><li><p>进入 <code>s2Tkk</code> 方法</p><pre><code class=language-js>                static s2Tkk(e, t, s, a) {
                    let n = [],
                        o = [e, t, s, a];
                    for (let e = 0; e &lt; o.length; e++)
                        if (o[e] &amp;&amp; null != o[e] &amp;&amp; o[e].toString().length &gt; 0) {
                            let t = n.length;
                            for (let t = 0; o[e] instanceof Array &amp;&amp; t &lt; o[e].length; t++) n.push(o[e][t]);
                            t === n.length &amp;&amp; n.push(o[e].toString())
                        }
                    return n.length &lt; 1 ? &quot;&quot; : this._cal(n.join(&quot;&quot;), this.EXT_VERSION)
                }
</code></pre><p>重点在于 <code>this._cal()</code> 方法与 <code>this.EXT_VERSION</code>参数</p></li><li><p>Ctrl + F 查找 this._cal() 方法, 得到了我们需要的加密方法</p><pre><code class=language-js>                static _cal(e, t) {
                    function s(e, t) {
                        for (var s = 0; s &lt; t.length - 2; s += 3) {
                            var a = t.charAt(s + 2);
                            a = &quot;a&quot; &lt;= a ? a.charCodeAt(0) - 87 : Number(a), a = &quot;+&quot; == t.charAt(s + 1) ? e &gt;&gt;&gt; a : e &lt;&lt; a, e = &quot;+&quot; == t.charAt(s) ? e + a &amp; 4294967295 : e ^ a
                        }
                        return e
                    }
                    return function(e, t) {
                        var a = t.split(&quot;.&quot;);
                        t = Number(a[0]) || 0;
                        for (var n = [], o = 0, i = 0; i &lt; e.length; i++) {
                            var r = e.charCodeAt(i);
                            128 &gt; r ? n[o++] = r : (2048 &gt; r ? n[o++] = r &gt;&gt; 6 | 192 : (55296 == (64512 &amp; r) &amp;&amp; i + 1 &lt; e.length &amp;&amp; 56320 == (64512 &amp; e.charCodeAt(i + 1)) ? (r = 65536 + ((1023 &amp; r) &lt;&lt; 10) + (1023 &amp; e.charCodeAt(++i)), n[o++] = r &gt;&gt; 18 | 240, n[o++] = r &gt;&gt; 12 &amp; 63 | 128) : n[o++] = r &gt;&gt; 12 | 224, n[o++] = r &gt;&gt; 6 &amp; 63 | 128), n[o++] = 63 &amp; r | 128)
                        }
                        for (e = t, o = 0; o &lt; n.length; o++) e = s(e += n[o], &quot;+-a^+6&quot;);
                        return e = s(e, &quot;+-3^+b+-f&quot;), 0 &gt; (e ^= Number(a[1]) || 0) &amp;&amp; (e = 2147483648 + (2147483647 &amp; e)), (a = e % 1e6).toString() + &quot;.&quot; + (a ^ t)
                    }(e, t)
                }
</code></pre><p>在 static _cal(e,t) 这行下面, 添加, alert(e), alert(t), 查看 e, t 参数分别是什么</p><pre><code class=language-bash>e: &quot;&quot;, # 为空
t: B00DQFGJR4 # 为我们需要查询的 asin
</code></pre><p>进一步进行的确认参数位置, 到这里需要的参数就分析完成了</p></li><li><p>同理可查找到, this.EXT_VERSION 参数</p><pre><code class=language-js>                static init() {
                    this.EXT_VERSION = a.a.version().replace(/\./, &quot;00&quot;).replace(/\./g, &quot;0&quot;) + &quot;.1364508470&quot;
                }
</code></pre><p>其中 <code>a.a.version()</code> 经过分析可以知道为, 卖家精灵的版本号: 3.1.4, 版本号会随时间而更新, 请注意</p></li><li><p>将上面的 js 代码整理一下, 如下</p><pre><code class=language-js>function extVersion() {
    // 就是插件的版本, 替换了 . 再拼接了一个字符串而成
    // 如果插件更新了版本, 手动更新一下插件的版本号即可
    chrome_ext_version = '3.1.4' //300104.1364508470
    return chrome_ext_version.replace(/\./, &quot;00&quot;).replace(/\./g, &quot;0&quot;) + &quot;.1364508470&quot;
         
}
         
function s2Tkk(e, t, s, a) {
    let n = [],
        o = [e, t, s, a];
    for (let e = 0; e &lt; o.length; e++)
        if (o[e] &amp;&amp; null != o[e] &amp;&amp; o[e].toString().length &gt; 0) {
            let t = n.length;
            for (let t = 0; o[e] instanceof Array &amp;&amp; t &lt; o[e].length; t++) n.push(o[e][t]);
            t === n.length &amp;&amp; n.push(o[e].toString())
        }
    return n.length &lt; 1 ? &quot;&quot; : _cal(n.join(&quot;&quot;), extVersion())
}
         
function _cal(e, t) {
         
    function s(e, t) {
        for (var s = 0; s &lt; t.length - 2; s += 3) {
            var a = t.charAt(s + 2);
            a = &quot;a&quot; &lt;= a ? a.charCodeAt(0) - 87 : Number(a), a = &quot;+&quot; == t.charAt(s + 1) ? e &gt;&gt;&gt; a : e &lt;&lt; a, e = &quot;+&quot; == t.charAt(s) ? e + a &amp; 4294967295 : e ^ a
        }
        return e
    }
         
    return function (e, t) {
        var a = t.split(&quot;.&quot;);
        t = Number(a[0]) || 0;
        for (var n = [], o = 0, i = 0; i &lt; e.length; i++) {
            var r = e.charCodeAt(i);
            128 &gt; r ? n[o++] = r : (2048 &gt; r ? n[o++] = r &gt;&gt; 6 | 192 : (55296 == (64512 &amp; r) &amp;&amp; i + 1 &lt; e.length &amp;&amp; 56320 == (64512 &amp; e.charCodeAt(i + 1)) ? (r = 65536 + ((1023 &amp; r) &lt;&lt; 10) + (1023 &amp; e.charCodeAt(++i)), n[o++] = r &gt;&gt; 18 | 240, n[o++] = r &gt;&gt; 12 &amp; 63 | 128) : n[o++] = r &gt;&gt; 12 | 224, n[o++] = r &gt;&gt; 6 &amp; 63 | 128), n[o++] = 63 &amp; r | 128)
        }
        for (e = t, o = 0; o &lt; n.length; o++) e = s(e += n[o], &quot;+-a^+6&quot;);
        return e = s(e, &quot;+-3^+b+-f&quot;), 0 &gt; (e ^= Number(a[1]) || 0) &amp;&amp; (e = 2147483648 + (2147483647 &amp; e)), (a = e % 1e6).toString() + &quot;.&quot; + (a ^ t)
    }(e, t)
}
</code></pre></li><li><p>使用 Python 进行调用</p><pre><code class=language-python>import execjs
         
node = execjs.get()
file = './sellersprite.js'
ctx = node.compile(open(file, 'r', encoding='utf8').read())
         
# 数据源的 tk
e = ''
t = 'B00DQFGJR4'
         
print(ctx.call('s2Tkk', e, t)) 
# 得到结果, 与我们抓包请求中的 tk 参数结果一致
# 58497.291017
</code></pre></li><li><p>插件登录过程中的参数, 也是同理, 大家可以自行实践</p><p>如需要帮助, 可以通过 <a href=https://github.com/CLannadZSY>Github</a> 联系我</p><p><img src=image-20220325110037709.png alt=image-20220325110037709></p></li></ol></li></ol></li></ol></article></div></div><script src=https://utteranc.es/client.js repo=CLannadZSY/clannadzsy.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Copyright © 2020-present <a href=https://github.com/CLannadZSY/>clannadzsy</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://clannad.icu/js/highlight.min.2c793eb7599ae4975966407f455873eca25c0dd1146f2ba6a8ca933c3ee5a244f8e3a48c5b73694a76709db65ff3e7eedf2a55fc3b0c03510b2eca2b8635c8da.js integrity="sha512-LHk+t1ma5JdZZkB/RVhz7KJcDdEUbyumqMqTPD7lokT446SMW3NpSnZwnbZf8+fu3ypV/DsMA1ELLsorhjXI2g==" crossorigin=anonymous defer></script><script src=https://clannad.icu/main.min.7ab523108435955765bcb88a0ee704f412ba01646b5478e84f3b9feb24f0ce750a14c3f7bd9a62408fe21e41996d361a9eb29f77e85dfe77b7e17f7623bd3a97.js integrity="sha512-erUjEIQ1lVdlvLiKDucE9BK6AWRrVHjoTzuf6yTwznUKFMP3vZpiQI/iHkGZbTYanrKfd+hd/ne34X92I706lw==" crossorigin=anonymous defer></script><script src=https://clannad.icu/index.min.2ab4b3ba0de0d49f020a532eda219cbbae89f190caed914c8e9e8d0b0022a730fed8c6d6fbb9ad71f5a0ffab295a9fa0dd4410e342625571c9a7be78084cc899.js integrity="sha512-KrSzug3g1J8CClMu2iGcu66J8ZDK7ZFMjp6NCwAipzD+2MbW+7mtcfWg/6spWp+g3UQQ40JiVXHJp754CEzImQ==" crossorigin=anonymous defer></script></body></html>